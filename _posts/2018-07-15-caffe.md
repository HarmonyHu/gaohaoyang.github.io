---
layout: post
title: ubuntu下使用caffe
categories: 深度学习
tags: Caffe
---

* content
{:toc}
## 一、安装依赖

```shell
$ sudo apt-get install libprotobuf-dev libleveldb-dev libsnappy-dev libopencv-dev libhdf5-serial-dev protobuf-compiler
$ sudo apt-get install --no-install-recommends libboost-all-dev
$ sudo apt-get install libgflags-dev libgoogle-glog-dev liblmdb-dev
$ sudo apt-get install libatlas-base-dev
$ sudo apt-get install python-dev
```



## 二、下载编译Caffe

1. 下载caffe源码：[caffe](<https://github.com/BVLC/caffe>)

2. 修改配置文件，`cp Makefile.config.example Makefile.config`，修改`Makefile.config`:

   ```makefile
   CPU_ONLY := 1
   INCLUDE_DIRS := $(PYTHON_INCLUDE) /usr/local/include /usr/include/hdf5/serial
   LIBRARY_DIRS := $(PYTHON_LIB) /usr/local/lib /usr/lib /usr/lib/x86_64-linux-gnu /usr/lib/x86_64-linux-gnu/hdf5/serial 
   ```

3. 编译Caffe

   ```shell
   make all
   make test
   make runtest
   ```

4. 编译Python接口

   * `sudo apt-get install python-pip`

   * 安装`python/requirements.txt`中的依赖库

     ```shell
     sudo apt-get install gfortran
     cd python
     for req in $(cat requirements.txt); do pip install $req; done
     cd ..
     sudo pip install -r python/requirements.txt
     ```

   * 编译`make pycaffe`

   * 验证`python import caffe`

## 三、训练模型

1. 准备数据集

   ```shell
   $ ./data/mnist/get_mnist.sh
   $ ./examples/mnist/creat_mnist.sh
   ```

2. 将`examples/mnist/lenet_solver.prototxt`中的GPU改成CPU

3. 执行脚本`./examples/mnist/train_lenet.sh`